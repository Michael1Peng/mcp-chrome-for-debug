# Chrome浏览器自动化 - 信息架构

## 项目整体架构

```
Chrome浏览器自动化系统架构
┌────────────────────────────────────────────────────────────┐
│                      MCP服务端                              │
└─────────────────┬──────────────────────────────────────────┘
                  │
    ┌─────────────┼─────────────┬──────────────┬────────────┐
    ↓             ↓             ↓              ↓            ↓
┌─────────┐ ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────┐
│共享库   │ │扩展应用 │ │本地服务器│ │WASM模块  │ │工具接口│
└────┬────┘ └────┬────┘ └────┬─────┘ └────┬─────┘ └────┬────┘
     │          │           │            │           │
     ├─类型定义 ├─后台脚本   ├─原生通信    ├─数学计算   ├─浏览器操作
     ├─常量配置 ├─内容脚本   ├─MCP协议    ├─性能优化   ├─网络监控
     ├─工具定义 ├─UI交互    ├─扩展桥接   └─WebAssembly ├─数据获取
     └─通信协议 └─权限管理   └─进程管理                └─自动化控制

【核心通信流程】
┌───────────────────────────────────────┐
│ 通信链路：MCP客户端 ↔ 本地服务器 ↔ Chrome扩展 ↔ 网页 │
├───────────────────────────────────────┤
│ • MCP协议 - 标准化工具调用接口         │
│ • 原生消息 - 本地服务器与扩展通信       │
│ • 内容脚本 - 扩展与网页交互            │
│ • Chrome API - 浏览器功能调用         │
└───────────────────────────────────────┘
```

## Chrome扩展模块架构

```
Chrome扩展功能架构
┌────────────────────────────────────────────────────────────┐
│                     Chrome扩展核心                          │
└─────────────────┬──────────────────────────────────────────┘
                  │
    ┌─────────────┼─────────────┬──────────────┬────────────┐
    ↓             ↓             ↓              ↓            ↓
┌─────────┐ ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────┐
│后台脚本 │ │内容脚本 │ │注入脚本  │ │权限管理  │ │存储管理│
└────┬────┘ └────┬────┘ └────┬─────┘ └────┬─────┘ └────┬────┘
     │          │           │            │           │
     ├─消息路由 ├─DOM操作   ├─点击助手    ├─标签页权限 ├─配置存储
     ├─API调用  ├─事件监听  ├─截图助手    ├─网络权限   ├─状态管理
     ├─通信桥接 ├─数据提取  ├─表单助手    ├─书签权限   ├─缓存管理
     └─生命周期 └─页面交互  ├─键盘助手    ├─历史权限   └─数据同步
                           ├─网络助手    └─调试权限
                           └─元素定位

【扩展工作流程】
┌───────────────────────────────────────┐
│ 流程：接收命令 → 验证权限 → 执行操作 → 返回结果 │
├───────────────────────────────────────┤
│ • 命令解析 - 工具名称和参数验证        │
│ • 权限检查 - 确保操作安全性           │
│ • 脚本注入 - 动态加载功能模块         │
│ • 结果收集 - 统一格式返回数据         │
└───────────────────────────────────────┘
```

## 工具接口模块架构

```
浏览器自动化工具接口
┌────────────────────────────────────────────────────────────┐
│                     工具接口层                              │
└─────────────────┬──────────────────────────────────────────┘
                  │
┌─────────────────┼─────────────────┬───────────────────────┐
│                 │                 │                       │
↓                 ↓                 ↓                       ↓
┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────────┐
│页面操作  │  │网络功能  │  │数据获取  │  │浏览器管理    │
└────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────────┘
     │             │             │             │
     ├─导航跳转     ├─网络请求     ├─页面内容     ├─窗口标签页
     ├─元素点击     ├─请求监控     ├─元素信息     ├─历史记录
     ├─表单填写     ├─响应捕获     ├─截图数据     ├─书签管理
     ├─键盘输入     ├─调试器API   ├─控制台日志   ├─前进后退
     ├─页面截图     └─WebRequest   ├─搜索结果     └─标签关闭
     └─脚本注入                   └─交互元素

【工具调用模式】
┌───────────────────────────────────────┐
│ 模式：同步调用 / 异步执行 / 事件监听    │
├───────────────────────────────────────┤
│ • 即时操作 - 点击、填写、导航         │
│ • 延时等待 - 页面加载、网络请求       │
│ • 持续监控 - 网络活动、控制台输出     │
│ • 状态查询 - 页面状态、元素属性       │
└───────────────────────────────────────┘
```

## 核心功能模块详细说明

### 【模块：页面操作】

```
┌───────────────────────────────────────┐
│ 模块：页面操作                        │
├───────────────────────────────────────┤
│ 一级功能：                            │
│ • chrome_navigate - 页面导航跳转      │
│ • chrome_click_element - 元素点击     │
│ • chrome_fill_or_select - 表单填写    │
│ • chrome_keyboard - 键盘输入          │
│ • chrome_screenshot - 页面截图        │
│ • chrome_inject_script - 脚本注入     │
│ • chrome_get_interactive_elements - 交互元素获取 │
├───────────────────────────────────────┤
│ 权限要求：activeTab, scripting        │
│ 数据来源：DOM API, Chrome Extension API │
└───────────────────────────────────────┘
```

### 【模块：网络功能】

```
┌───────────────────────────────────────┐
│ 模块：网络功能                        │
├───────────────────────────────────────┤
│ 一级功能：                            │
│ • chrome_network_request - 网络请求   │
│ • chrome_network_capture_start - 请求监控启动 │
│ • chrome_network_capture_stop - 请求监控停止  │
│ • chrome_network_debugger_start - 调试器启动  │
│ • chrome_network_debugger_stop - 调试器停止   │
├───────────────────────────────────────┤
│ 权限要求：webRequest, debugger        │
│ 数据来源：Chrome WebRequest API, Debugger API │
└───────────────────────────────────────┘
```

### 【模块：数据获取】

```
┌───────────────────────────────────────┐
│ 模块：数据获取                        │
├───────────────────────────────────────┤
│ 一级功能：                            │
│ • chrome_get_web_content - 页面内容   │
│ • get_windows_and_tabs - 窗口标签信息 │
│ • search_tabs_content - 内容搜索      │
│ • chrome_console - 控制台日志         │
├───────────────────────────────────────┤
│ 权限要求：tabs, activeTab             │
│ 数据来源：DOM API, Console API        │
└───────────────────────────────────────┘
```

### 【模块：浏览器管理】

```
┌───────────────────────────────────────┐
│ 模块：浏览器管理                      │
├───────────────────────────────────────┤
│ 一级功能：                            │
│ • chrome_close_tabs - 标签页关闭      │
│ • chrome_go_back_or_forward - 历史导航 │
│ • chrome_history - 浏览历史           │
│ • chrome_bookmark_search - 书签搜索   │
│ • chrome_bookmark_add - 书签添加      │
│ • chrome_bookmark_delete - 书签删除   │
├───────────────────────────────────────┤
│ 权限要求：tabs, history, bookmarks    │
│ 数据来源：Chrome History API, Bookmarks API │
└───────────────────────────────────────┘
```
